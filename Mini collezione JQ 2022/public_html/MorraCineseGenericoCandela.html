<!DOCTYPE html>
<html>
    <head>
	<title>Morra cinese con Candela</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<script src="https://code.jquery.com/jquery-3.4.0.min.js" type="text/javascript"></script>
	
	<script src="MetodoVomitevoleEvidenziazioneAree.js" type="text/javascript"></script>
	
	<script type="text/javascript">
	    $(function()
	    {		
		// Stando a https://www.html.it/articoli/javascript-var-let-e-const/ dichiarando con let le variabili si comportano
		// in modo simile agli altri linguaggi in quanto hanno lo scope; var invece √® globale alla pagina.
		let tentativi = 0,MaxTentativi=5;
		let giocatore, computer;
		let puntiC = 0, puntiG = 0;
		
		// Segno nel primo elemento quello che batte il secondo
		// Per essere equilibrato il gioco ogni segno deve avere tante entrate quante uscite
		// e disponendo i segni su un poligono come nelle immagini, devono essere disegnate tutte le diagonali e i lati
		// In questo modo si gestiscono anche i pareggi
		const diagramma=[
			    ["Sasso","Forbice"],
			    ["Forbice","Carta"],
			    ["Forbice","Candela"],
			    ["Candela","Carta"],
			    ["Carta","Sasso"]
				];
		console.log(diagramma);
		class cDiagramma
		{
		    constructor(a,b)
		    {
			this.Vincente=a;
			this.Perdente=b;
		    }
		}

		const Conversore=(coppia) => { return new cDiagramma(coppia[0],coppia[1]);}
		let oDiagramma=diagramma.map(Conversore);
		console.log(oDiagramma.map(JSON.stringify));
		
		// Non √® possibile richiamare questa funzione in un altro modo:
		// Con href=javascript:NomeFunzione deve essere posizionata fuori  dalla funzione JQuery ma non riesce ad accedere alla variabili
		$("area").click(function ()
		{		    
		    if(tentativi==MaxTentativi)return; // La partita √® terminata
		    giocatore=($(this).attr("id"));
		    
		    var PossibiliGiocate="Candela,Sasso,Forbice,Carta";
		    const vet = PossibiliGiocate.split(",");
		    computer=vet[Math.floor(Math.random() * vet.length)];
		    
		    $("#MossaPC").html("<img src='morra/"+computer+".png' width=64 height=64>");
		    
		    
		    
		    tentativi++;
		    
		    console.log(giocatore,computer);
		    const vincente = (giocata) => { return giocata.Vincente==giocatore && giocata.Perdente==computer;}
		    const perdente = (giocata) => { return giocata.Vincente==computer && giocata.Perdente==giocatore;}
		    
		    let vittoria = oDiagramma.filter(vincente); // Se trova 1 allora c' √®
		    let sconfitta = oDiagramma.filter(perdente);
		    
		    console.log(vittoria);
		    console.log(sconfitta);
		    
		    if(vittoria.length==1)
		    {
			$("#esito").text("Hai fatto un punto");
			puntiG++;
		    }
		    else if(sconfitta.length==1)
		    {
			$("#esito").text("Il computer ha fatto un punto");
			puntiC++;
		    }
		    else
		    {
			$("#esito").text("Parit√†");
		    }
		    
		    AggiornaValori();
		    
		    if(tentativi==MaxTentativi)
		    {
			if(puntiC==puntiG)$("#finale").text("Parit√†");
			else if(puntiC>puntiG)$("#finale").text("Hai perso!");
			else $("#finale").text("Hai vinto!");
		    }
		});

		
		function AggiornaValori()
		{
		    $("#tentativoVal").text(tentativi+" di "+MaxTentativi);
		    $("#puntiPC").text(puntiC);
		    $("#puntiUmano").text(puntiG);
		}
		
		myInit('InputUtente','myCanvas');
	    });
	    
	    function myInit(img,canv)
	    {
		// get the target image
		var img = byId(img);
		var x,y, w,h;
		// get it's position and width+height
		x = img.offsetLeft;
		y = img.offsetTop;
		w = img.clientWidth;
		h = img.clientHeight;
		// move the canvas, so it's contained by the same parent as the image
		var imgParent = img.parentNode;
		var canvas = byId(canv);
		imgParent.appendChild(canvas);
		// place the canvas in front of the image
		canvas.style.zIndex = 1;
		// position it over the image
		canvas.style.left = x+'px';
		canvas.style.top = y+'px';
		// make same size as the image
		canvas.setAttribute('width', w+'px');
		canvas.setAttribute('height', h+'px');
		// get it's context
		hdc = canvas.getContext('2d');
		// set the 'default' values for the colour/width of fill/stroke operations
		hdc.fillStyle = 'red';
		hdc.strokeStyle = 'red';
		hdc.lineWidth = 2;
	    }
	</script>
	
	
	<link rel="stylesheet" href="Pulsanti.css"/>
	<link rel="stylesheet" href="MorraCinese.css"/>
	
	<style>
	    canvas
	    {
		pointer-events: none;       /* make the canvas transparent to the mouse - needed since canvas is position infront of image */
		position: absolute;
	    }
	</style>
    </head>
    <body>	
	<canvas id='myCanvas'></canvas><!-- Questo dovrebbe servire per disegnare (evidenziare aree) poi ci pensa la funzione di OnLoad a posizionarlo -->
	
	
	<!-- https://www.jqueryitalia.org/tutorial/dettagli/una-mappa-negozi-interattiva/
	https://www.ilblogdiunprogrammatore.it/4509-mappa-immagine-con-jquery-e-gimp.html
	poi evidenziare con css hover -->
	
	
	<table width="100%"><tr>
	    <td width="50%"><h1>üñ•Ô∏è <span id="puntiPC">0</span></h1></td>
	    <td width="50%" align="right"><h1><span id="puntiUmano">0</span> üßíüèº</h1></td>
	</tr></table>
	
	
	<center>
	    <h1>Tentativo <span id="tentativoVal">...</span></h1>
	    Scegli<br>
	    <img src='morra/schema candela 2.png' width="174" height="174" id="InputUtente" usemap="#MappaAttiva">
	    <!-- Come supponevo, le coordinate delle aree vanno scalate con l' immagine -->
	    <map id='MappaAttiva'>
		<area shape="circle" href="#" coords="32,32,32" id="Sasso" onmouseover='myHover(this);' onmouseout='myLeave("myCanvas");'>
		<area shape="circle" href="#" coords="32,142,32" id="Forbice" onmouseover='myHover(this);' onmouseout='myLeave("myCanvas");'>
		<area shape="circle" href="#" coords="142,32,32" id="Carta" onmouseover='myHover(this);' onmouseout='myLeave("myCanvas");'>
		<area shape="circle" href="#" coords="142,142,32" id="Candela" onmouseover='myHover(this);' onmouseout='myLeave("myCanvas");'>
	    </map>
	</center>
	
    
    
	
	<center><h3>Mossa del computer</h3></center>
	<center><h1 id="MossaPC"></h1></center>
	<center><h2 id="esito"></h2></center>
	<center><h1 id="finale"></h1></center>
	<!-- Anche se credo questo venga comunque intercettato, non dovrebbe creare problemi in quanto cambier√† pagina -->
	<center><a href='Index.html'><button class="button-73">Elenco giochi</button></a></center>
	<center>Leggi la console per lo storico delle mosse</center>
	<br><br><br><center><img src='morra/schema candela.png' width="128" height="128"></center>
    </body>
</html>
